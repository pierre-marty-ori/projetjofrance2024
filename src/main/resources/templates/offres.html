<div th:insert="~{fragments/header :: header}"></div>
<div th:insert="~{fragments/navbar :: navbar}"></div>

<div class="container my-4">

    <h1 class="text-center mb-4" th:text="${title}"></h1>

    <div class="row">
        <div th:each="offre : ${offres}" class="col-md-4 mb-4">
            <div class="card h-100">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title text-center" th:text="${offre.nom}">Offre Title</h5>
                    <p class="card-text flex-grow-1 text-center" th:text="${offre.description}">Description</p>
                    <div class="mt-auto">
                        <p class="card-text h5 text-primary mb-3 text-center">
                            <span th:text="${offre.price}"></span> â‚¬
                        </p>
                        <button type="button"
                                class="btn btn-primary add-cart w-100"
                                th:attr="data-offre-id=${offre.id}">
                            <i class="fas fa-shopping-cart me-2"></i>Ajouter au panier
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.querySelectorAll(".add-cart").forEach(btn => {
       btn.addEventListener("click", function () {
           const offreId = this.getAttribute("data-offre-id");

           const token = document.querySelector('meta[name="_csrf"]').content;
           const header = document.querySelector('meta[name="_csrf_header"]').content;

           fetch(`/panier/ajouter/${offreId}`, {
               method: "POST",
               headers: {
                   [header]: token
               }
           })
           .then(response => {
               if (!response.ok) throw new Error("Erreur HTTP " + response.status);
               return response.text();
           })
           .then(count => {
               document.querySelector("#cart-icon span").innerText = count;
           })
           .catch(err => console.error(err));
       });
   });

</script>


<div th:insert="~{fragments/footer :: footer}"></div>